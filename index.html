<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÂÖ±ËØÜÁºñÂπ¥Âè≤ | Consensus Chronicle</title>
  <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; background: #0f0f1a; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const CONFIG = {
      ROOM_SIZE: { min: 2, max: 8 },
      DEBATE_DURATION: 90,
      VOTE_DURATION: 30,
      TOTAL_ROUNDS: 5,
      ENTRY_FEE: 10000000000000000,
      ROOM_TIMEOUT_AI: 60000,
      ROOM_TIMEOUT_CLOSE: 120000,
      GENLAYER_API: 'https://studio.genlayer.com:8443/api',
      GENLAYER_CONTRACT: '0x4F5F132ba540f1C685B0188D59990302903aE186',
      FIREBASE: {
        apiKey: "AIzaSyBX4tOb30jWKK6aBUsqERQaOAF4CxCfMmQ",
        authDomain: "consensus-chronicle.firebaseapp.com",
        databaseURL: "https://consensus-chronicle-default-rtdb.firebaseio.com",
        projectId: "consensus-chronicle"
      }
    };

    const STORY_ARCS = {
      fantasy: {
        name: 'Â•áÂπªÂÜíÈô©', icon: 'üè∞',
        opening: 'Âè§ËÄÅÁöÑÈ¢ÑË®ÄÁªà‰∫éÂ∫îÈ™å‚Äî‚ÄîÊ≤âÁù°ÂçÉÂπ¥ÁöÑÈªëÈæôËãèÈÜí‰∫Ü„ÄÇÁéãÂõΩÂç±Âú®Êó¶Â§ïÔºåÂõΩÁéãÁ¥ßÊÄ•Âè¨ÈõÜ‰∫ÜÂêÑÂú∞Ëã±ÈõÑÂïÜËÆÆÂØπÁ≠ñ...',
        rounds: [
          { context: 'ÈªëÈæôÁöÑÂ®ÅËÉÅËø´Âú®ÁúâÁù´ÔºåÁéãÂõΩÂøÖÈ°ªÂÅöÂá∫Á¨¨‰∏Ä‰∏™ÂÖ≥ÈîÆÂÜ≥ÂÆö„ÄÇ', a: { text: 'Á´ãÂç≥ÈõÜÁªìÂÜõÈòüÔºå‰∏ªÂä®Âá∫ÂáªÈæôÂ∑¢ÔºåÂú®ÂÆÉÂÆåÂÖ®ËãèÈÜíÂâçÂ∞ÜÂÖ∂Ê∂àÁÅ≠„ÄÇ', tag: 'ÂÖàÂèëÂà∂‰∫∫¬∑ÊøÄËøõ', consequence: 'ÁéãÂõΩÂÜõÈòüÂêëÈæôÂ∑¢ËøõÂèëÔºå‰ΩÜÈÄî‰∏≠ÈÅ≠ÈÅá‰∫ÜÈæôÁöÑÁà™ÁâôÔºåÊçüÂ§±ÊÉ®Èáç...' }, b: { text: 'Ê¥æÈÅ£‰ΩøËÄÖÂØªÊ±ÇÁ≤æÁÅµÊóèÁöÑÂ∏ÆÂä©Ôºå‰ªñ‰ª¨ÊõæÂú®ÂçÉÂπ¥ÂâçÂ∞ÅÂç∞ËøáÈªëÈæô„ÄÇ', tag: 'ÂØªÊ±ÇËÅîÁõü¬∑Á®≥Â¶•', consequence: '‰ΩøËÄÖÊàêÂäüËÅîÁ≥ªÂà∞‰∫ÜÁ≤æÁÅµÊóèÔºå‰ΩÜ‰ªñ‰ª¨ÊèêÂá∫‰∫ÜËãõÂàªÁöÑÊù°‰ª∂...' } },
          { contextA: 'ÂÜõÈòüÊçüÂ§±ÊÉ®ÈáçÔºå‰ΩÜÂ∑≤ÈÄºËøëÈæôÂ∑¢„ÄÇÊ≠§Êó∂Êé¢Â≠êÊù•Êä•ÔºöÈæôÂ∑¢ÂÜÖÂèëÁé∞‰∫ÜÈæôËõã„ÄÇ', contextB: 'Á≤æÁÅµÊóèË¶ÅÊ±Ç‰∫∫Á±ª‰∫§Âá∫Âú£Ââë‰Ωú‰∏∫‰ø°‰ªªÁöÑËØÅÊòéÔºåÂê¶Âàô‰∏ç‰∫àÊè¥Âä©„ÄÇ', a: { text: 'ÊëßÊØÅÈæôËõãÔºåÂΩªÂ∫ïÊñ≠ÁªùÈªëÈæô‰∏ÄÊóèÁöÑË°ÄËÑâÔºåÊ∞∏Èô§ÂêéÊÇ£„ÄÇ', tag: 'Êñ©ËçâÈô§Ê†π¬∑ÊÆãÈÖ∑', consequenceFromA: 'ÈæôËõãË¢´ÊØÅÔºåÈªëÈæôÁãÇÊÄíÔºåÊàòÊñóÊõ¥Âä†ÊÉ®ÁÉà...', consequenceFromB: 'ÊãíÁªù‰∫§Âá∫Âú£ÂâëÂêéÔºå‰∫∫Á±ªÂÜ≥ÂÆöÁã¨Ëá™Èù¢ÂØπÈªëÈæôÔºåÊëßÊØÅ‰∫ÜÈæôËõã...' }, b: { text: '‰øùÁïôÈæôËõãÔºåÊàñËÆ∏ÂèØ‰ª•Áî®ÂÆÉ‰∏éÈªëÈæôË∞àÂà§ÔºåÊàñÂüπÂÖª‰∏ÄÊù°ÂèãÂñÑÁöÑÈæô„ÄÇ', tag: 'ÁïôÊúâ‰ΩôÂú∞¬∑ÂÜíÈô©', consequenceFromA: 'ÈæôËõãË¢´ÁßòÂØÜ‰øùÊä§Ëµ∑Êù•Ôºå‰ΩÜÊ∂àÊÅØÊ≥ÑÈú≤ÂºïÂèë‰∫ÜÂÜÖÈÉ®ÂàÜË£Ç...', consequenceFromB: '‰∫§Âá∫Âú£ÂâëÊç¢ÂèñÁ≤æÁÅµÊè¥Âä©ÔºåÂêåÊó∂‰øùÊä§‰∫ÜÈæôËõã...' } },
          { contextAA: 'ÈªëÈæôÂú®ÁãÇÊÄí‰∏≠Â±ïÁé∞Âá∫ÊØÅÂ§©ÁÅ≠Âú∞ÁöÑÂäõÈáèÔºåÂÜõÈòüÂç≥Â∞ÜÂÖ®ÂÜõË¶ÜÊ≤°„ÄÇ', contextAB: 'ÂÜÖÈÉ®ÂàÜË£ÇÂØºËá¥ÂÜõÂøÉÊ∂£Êï£ÔºåÊúâ‰∫∫‰∏ªÂº†ÊäïÈôçÔºåÊúâ‰∫∫ÂùöÊåÅÊàòÊñó„ÄÇ', contextBA: 'Áã¨Ëá™‰ΩúÊàòÁöÑ‰∫∫Á±ªÂÜõÈòüÂú®Ê≤°ÊúâÁ≤æÁÅµÈ≠îÊ≥ïÁöÑÊîØÊåÅ‰∏ãÈô∑ÂÖ•Ëã¶Êàò„ÄÇ', contextBB: 'Á≤æÁÅµÂÜõÈòüÊäµËææÔºå‰ΩÜ‰ªñ‰ª¨ÂØπÈæôËõãÁöÑÂ≠òÂú®ÊÑüÂà∞‰∏çÊª°ÔºåÂ®ÅËÉÅÊí§ÂÜõ„ÄÇ', a: { text: '‰ΩøÁî®Á¶ÅÂøåÈ≠îÊ≥ïÔºåÁâ∫Áâ≤ÊñΩÊ≥ïËÄÖÁöÑÁîüÂëΩÊù•ÈáçÂàõÈªëÈæô„ÄÇ', tag: 'Áâ∫Áâ≤Â∞èÊàë¬∑ÊÇ≤Â£Æ', consequence: 'Á¶ÅÂøåÈ≠îÊ≥ïÁîüÊïàÔºåÈªëÈæôÈáç‰º§Âù†ËêΩÔºå‰ΩÜ‰ª£‰ª∑ÊòØÊÉ®ÈáçÁöÑ...' }, b: { text: '‰∏ã‰ª§Êí§ÈÄÄÔºå‰øùÂ≠òÂÆûÂäõÔºåÁ≠âÂæÖÊõ¥Â•ΩÁöÑÊó∂Êú∫ÂÜçÊàò„ÄÇ', tag: '‰ª•ÈÄÄ‰∏∫Ëøõ¬∑ÂøçËÄê', consequence: 'ÂÜõÈòüÊí§ÈÄÄÂà∞ÂÆâÂÖ®Âú∞Â∏¶Ôºå‰ΩÜÈªëÈæôË∂ÅÊú∫ÊëßÊØÅ‰∫ÜÊï∞‰∏™ÊùëÂ∫Ñ...' } },
          { contextA: 'ÈªëÈæôÈáç‰º§ÂêéÈÄÄÂõûÂ∑¢Á©¥Áñó‰º§Ôºå‰ΩÜÂÆÉÁöÑÊÑ§ÊÄí‰ΩøÂæóÊï¥‰∏™Âå∫ÂüüÈÉΩÁ¨ºÁΩ©Âú®Ê≠ª‰∫°Ê∞îÊÅØ‰∏≠„ÄÇ', contextB: 'Êí§ÈÄÄÂêéÔºåÁéãÂõΩÂºÄÂßãÂèçÊÄùÁ≠ñÁï•ÔºåÊ∞ëÈó¥Âá∫Áé∞‰∫ÜÂêÑÁßçÂ£∞Èü≥ÂíåÂäøÂäõ„ÄÇ', a: { text: 'Ë∂ÅÈªëÈæôÁñó‰º§ÊúüÈó¥ÂèëËµ∑ÊÄªÊîªÔºå‰∏Ä‰∏æÂ∞ÜÂÖ∂Ê∂àÁÅ≠„ÄÇ', tag: '‰πòËÉúËøΩÂáª¬∑ÂÜ≥Áªù', consequence: 'ÊÄªÊîªÂºÄÂßãÔºåËøôÂ∞ÜÊòØÂÜ≥ÂÆöÁéãÂõΩÂëΩËøêÁöÑÊúÄÂêé‰∏ÄÊàò...' }, b: { text: 'Â∞ùËØï‰∏éÂèó‰º§ÁöÑÈªëÈæôÊ≤üÈÄöÔºåÂØªÊâæÂíåÂπ≥ÂÖ±Â≠òÁöÑÂèØËÉΩ„ÄÇ', tag: 'ÂåñÊïå‰∏∫Âèã¬∑ÁêÜÊÉ≥', consequence: '‰ΩøËÄÖÂÜíÊ≠ªÊé•ËøëÈªëÈæôÔºåÂá∫‰πéÊÑèÊñôÂú∞ÔºåÈªëÈæôÊÑøÊÑèÂØπËØù...' } },
          { contextA: 'ÊúÄÁªàÂÜ≥Êàò‰∏≠ÔºåÂèåÊñπÈÉΩ‰ªòÂá∫‰∫ÜÊÉ®Èáç‰ª£‰ª∑ÔºåËÉúË¥üÂç≥Â∞ÜÊè≠Êôì„ÄÇ', contextB: 'ÈªëÈæôÈÄèÈú≤ÂÆÉËãèÈÜíÊòØÂõ†‰∏∫ÊÑüÂèóÂà∞‰∫ÜÊõ¥Â§ßÁöÑÂ®ÅËÉÅ‚Äî‚ÄîÊù•Ëá™Ê∑±Ê∏äÁöÑÈÇ™Á•ûÂç≥Â∞ÜÈôç‰∏¥„ÄÇ', a: { text: '‰∏çÊÉú‰∏ÄÂàá‰ª£‰ª∑Ê∂àÁÅ≠ÈªëÈæôÔºåÂì™ÊÄïÁéãÂõΩÂåñ‰∏∫ÁÑ¶Âúü‰πüÂú®ÊâÄ‰∏çÊÉú„ÄÇ', tag: 'ÁéâÁü≥‰ø±ÁÑö¬∑ÊûÅÁ´Ø', ending: 'ÈªëÈæôË¢´Ê∂àÁÅ≠Ôºå‰ΩÜÁéãÂõΩ‰πüÂá†‰πéÂåñ‰∏∫Â∫üÂ¢ü„ÄÇÂπ∏Â≠òËÄÖÂºÄÂßã‰∫ÜÊº´ÈïøÁöÑÈáçÂª∫‰πãË∑ØÔºåÂéÜÂè≤Â∞ÜÈì≠ËÆ∞ËøôÂú∫ÊÉ®ËÉú„ÄÇ' }, b: { text: 'Êé•ÂèóÂëΩËøêÁöÑÂÆâÊéíÔºå‰∏éÈªëÈæôËææÊàêÂçèËÆÆÔºåÂÖ±ÂêåÈù¢ÂØπÊú™Êù•ÁöÑÊåëÊàò„ÄÇ', tag: 'Êè°ÊâãË®ÄÂíå¬∑Êô∫ÊÖß', ending: '‰∫∫Á±ª‰∏éÈªëÈæôËææÊàê‰∫ÜÂâçÊâÄÊú™ÊúâÁöÑÁõüÁ∫¶ÔºåÂÖ±ÂêåÂÆàÊä§ËøôÁâáÂ§ßÈôÜ„ÄÇ‰∏Ä‰∏™Êñ∞ÁöÑÊó∂‰ª£Â∞±Ê≠§ÂºÄÂêØ„ÄÇ' } }
        ]
      },
      scifi: {
        name: 'ÁßëÂπªÊú™Êù•', icon: 'üöÄ',
        opening: '2157Âπ¥ÔºåÁÅ´ÊòüÊÆñÊ∞ëÂú∞"Êñ∞Â∏åÊúõ"Êî∂Âà∞‰∫Ü‰∏ÄÊÆµÊù•Ëá™Ê∑±Á©∫ÁöÑÁ•ûÁßò‰ø°Âè∑„ÄÇÁßëÂ≠¶ÂÆ∂‰ª¨Á†¥ËØëÂêéÂèëÁé∞ÔºöËøôÊòØ‰∏Ä‰∏™Ë≠¶Âëä‚Äî‚ÄîÂú∞ÁêÉÂ∞ÜÂú®100Â§©ÂêéË¢´Â∞èË°åÊòüÊíûÂáª„ÄÇÁÑ∂ËÄåÔºåÊÆñÊ∞ëÂú∞ÁöÑËµÑÊ∫êÂè™Â§üÊïë‰∏ÄÂçä‰∫∫...',
        rounds: [
          { context: 'Ê∂àÊÅØÂÖ¨Â∏ÉÂêéÔºåÊÆñÊ∞ëÂú∞Èô∑ÂÖ•ÊÅêÊÖå„ÄÇÈ¢ÜÂØºÂ±ÇÂøÖÈ°ªÁ´ãÂç≥ÂÅöÂá∫ÂÜ≥ÂÆö„ÄÇ', a: { text: 'Á´ãÂç≥ÂêØÂä®"ÊñπËàüËÆ°Âàí"ÔºåÈÄöËøáÊäΩÁ≠æÂÜ≥ÂÆöË∞ÅËÉΩÁôª‰∏äÈÄÉÁîüÈ£ûËàπ„ÄÇ', tag: 'ÂÖ¨Âπ≥ÊäΩÁ≠æ¬∑ÂÜ∑ÈÖ∑', consequence: 'ÊäΩÁ≠æÁªìÊûúÂÖ¨Â∏ÉÔºåËêΩÈÄâËÄÖÂºÄÂßãÁªùÊúõÂú∞ÊäóËÆÆÔºåÂÆâ‰øùÈÉ®ÈòüË¢´Ëø´‰ªãÂÖ•...' }, b: { text: 'ÈõÜ‰∏≠ÊâÄÊúâËµÑÊ∫êÁ†îÁ©∂‰ø°Âè∑Êù•Ê∫êÔºåÊàñËÆ∏ÈÇ£ÈáåÊúâÊãØÊïëÊâÄÊúâ‰∫∫ÁöÑÁ≠îÊ°à„ÄÇ', tag: 'ËøΩÂØªÂ∏åÊúõ¬∑ÂÜíÈô©', consequence: 'Á†îÁ©∂Âõ¢ÈòüÂèëÁé∞‰ø°Âè∑Êù•Ëá™‰∏Ä‰∏™Êú™Áü•ÊñáÊòéÔºå‰ªñ‰ª¨‰ºº‰πéÂú®ÈÇÄËØ∑‰∫∫Á±ª...' } },
          { contextA: 'ÊäóËÆÆÊºîÂèò‰∏∫Êö¥Âä®ÔºåÈÉ®ÂàÜËêΩÈÄâËÄÖÂç†È¢Ü‰∫ÜÈ£ûËàπÂèëÂ∞ÑÂå∫„ÄÇ', contextB: 'Ê∑±ÂÖ•ÂàÜÊûê‰ø°Âè∑ÂêéÔºåÂèëÁé∞ÈÇ£‰∏™ÊñáÊòéÂú®ÈÇÄËØ∑‰∫∫Á±ªÂéª‰∏Ä‰∏™ÈÅ•ËøúÁöÑÊòüÁ≥ªÔºå‰ΩÜÊóÖÁ®ãÈúÄË¶Å500Âπ¥„ÄÇ', a: { text: 'ÊéàÊùÉÂÆâ‰øùÈÉ®Èòü‰ΩøÁî®Ê≠¶ÂäõÔºåÁ°Æ‰øùÊñπËàüËÆ°ÂàíÊåâÊó∂ÊâßË°å„ÄÇ', tag: 'ÈìÅËÖïÈïáÂéã¬∑ÊïàÁéá', consequenceFromA: 'Êö¥Âä®Ë¢´ÈïáÂéãÔºå‰ΩÜËÆ∏Â§ö‰∫∫Âú®ÂÜ≤Á™Å‰∏≠‰∏ßÁîüÔºåÂπ∏Â≠òËÄÖÂøÉÂ≠òÊÄ®ÊÅ®...', consequenceFromB: 'ÊîæÂºÉ‰∏éÂ§ñÊòüÊñáÊòéËÅîÁ≥ªÔºå‰∏ìÊ≥®‰∫éÁé∞ÊúâÁöÑÈÄÉÁîüËÆ°Âàí...' }, b: { text: '‰∏éÊäóËÆÆËÄÖË∞àÂà§ÔºåÂ∞ùËØï‰øÆÊîπËÆ°ÂàíËÆ©Êõ¥Â§ö‰∫∫Ëé∑ÂæóÁîüÂ≠òÊú∫‰ºö„ÄÇ', tag: 'ÂØªÊ±ÇÂÖ±ËØÜ¬∑‰∫∫ÈÅì', consequenceFromA: 'Ë∞àÂà§ÂèñÂæóËøõÂ±ïÔºåÂ∑•Á®ãÂ∏àÊèêÂá∫ÂèØ‰ª•Ë∂ÖËΩΩÈ£ûËàπÔºå‰ΩÜÈ£éÈô©ÊûÅÂ§ß...', consequenceFromB: 'ÂÜ≥ÂÆöÊ¥æÈÅ£ÂÖàÈîãÈòüÂìçÂ∫îÈÇÄËØ∑ÔºåÂÖ∂‰Ωô‰∫∫ËøõÂÖ•ÂÜ∑ÂÜªÁù°Áú†Á≠âÂæÖ...' } },
          { contextAA: 'È£ûËàπË∂ÖËΩΩ‰ºöÂØºËá¥ÊàêÂäüÁéá‰ªé95%ÈôçÂà∞60%Ôºå‰ΩÜËÉΩÂ§öÊïë30%ÁöÑ‰∫∫„ÄÇ', contextAB: 'ÂÖàÈîãÈòüÂá∫ÂèëÂêéÂ§±ÂéªËÅîÁ≥ªÔºåÂâ©‰ΩôËµÑÊ∫êÂè™Â§üÁª¥ÊåÅ60Â§©„ÄÇ', contextBA: 'ÈÉ®ÂàÜÊøÄËøõÂàÜÂ≠ê‰∏çÊé•ÂèóË∞àÂà§ÁªìÊûúÔºåÂØÜË∞ãÁ†¥ÂùèÈ£ûËàπ„ÄÇ', contextBB: 'ÂÜ∑ÂÜªÁù°Áú†ÊäÄÊúØÂ∞öÊú™ÂÆåÂñÑÔºåÊúâ30%ÁöÑÂ§±Ë¥•Áéá„ÄÇ', a: { text: 'Êé•ÂèóË∂ÖËΩΩÊñπÊ°àÔºåÁî®60%ÁöÑÊàêÂäüÁéáÊç¢ÂèñÊõ¥Â§ö‰∫∫ÁöÑÂ∏åÊúõ„ÄÇ', tag: 'ÂÜíÈô©Ê±ÇÂÖ®¬∑ËµåÂçö', consequence: 'Ë∂ÖËΩΩÊñπÊ°àÂêØÂä®ÔºåÊâÄÊúâ‰∫∫ÈÉΩÂú®Á•àÁ•∑Â•áËøπÂèëÁîü...' }, b: { text: 'Áª¥ÊåÅÂéüËÆ°ÂàíÔºåÁ°Æ‰øùËá≥Â∞ë‰∏ÄÂçä‰∫∫ËÉΩÂ§üÁ°ÆÂÆöÂ≠òÊ¥ª„ÄÇ', tag: 'Á®≥Â¶•Ê±ÇÂ≠ò¬∑Áé∞ÂÆû', consequence: 'ÂéüËÆ°ÂàíÁªßÁª≠ÊâßË°åÔºå‰ΩÜÁ§æ‰ºöÁöÑË£ÇÁóïÂ∑≤Êó†Ê≥ïÂº•Âêà...' } },
          { contextA: 'È£ûËàπËµ∑È£ûÂâçÔºåAIÁ≥ªÁªüÊ£ÄÊµãÂà∞‰∏Ä‰∏™ÊÉä‰∫∫ÁöÑÂèØËÉΩÊÄßÔºöÂ∞èË°åÊòüÁöÑËΩ®ÈÅìÂèØ‰ª•Ë¢´‰∫∫‰∏∫ÊîπÂèò„ÄÇ', contextB: 'ÂèëÂ∞ÑÂáÜÂ§áÂÆåÊàêÊó∂ÔºåÂÖàÈîãÈòüÁ™ÅÁÑ∂‰º†Êù•Ê∂àÊÅØÔºöÂ§ñÊòüÊñáÊòéÂèØ‰ª•Êèê‰æõÊäÄÊúØÊëßÊØÅÂ∞èË°åÊòüÔºå‰ΩÜÈúÄË¶Å‰∫∫Á±ªÊîæÂºÉÊ≠¶Âô®„ÄÇ', a: { text: 'Â∞ùËØïÊîπÂèòÂ∞èË°åÊòüËΩ®ÈÅìÔºåÂç≥‰ΩøÂ§±Ë¥•‰πüÂÄºÂæó‰∏ÄËØï„ÄÇ', tag: 'ÈÄÜÂ§©ÊîπÂëΩ¬∑Ëã±ÈõÑ', consequence: 'ÂÖ®ÊÆñÊ∞ëÂú∞ÁöÑËÉΩÊ∫êË¢´ÈõÜ‰∏≠Áî®‰∫éËøô‰∏™Â§ßËÉÜÁöÑËÆ°Âàí...' }, b: { text: 'ÊåâÂéüËÆ°ÂàíÊí§Á¶ªÔºå‰∏çË¶ÅÊääÊâÄÊúâÈ∏°ËõãÊîæÂú®‰∏Ä‰∏™ÁØÆÂ≠êÈáå„ÄÇ', tag: 'ÂàÜÊï£È£éÈô©¬∑Ë∞®ÊÖé', consequence: 'È£ûËàπÂºÄÂßãÊí§Á¶ªÔºå‰ΩÜÁïô‰∏ãÁöÑ‰∫∫Ê≤°ÊúâÊîæÂºÉÂ∏åÊúõ...' } },
          { contextA: 'ÊîπÂèòËΩ®ÈÅìÁöÑÂ∞ùËØïÊ∂àËÄó‰∫Ü80%ÁöÑËÉΩÊ∫êÔºåÂ∞èË°åÊòüÂÅèÁßª‰∫ÜÔºå‰ΩÜ‰∏çÂ§ü‚Äî‚ÄîÂÆÉ‰ªç‰ºöÊì¶ËøáÂú∞ÁêÉÂ§ßÊ∞îÂ±ÇÔºåÈÄ†ÊàêÂ∑®Â§ßÁÅæÈöæ„ÄÇ', contextB: 'Â§ñÊòüÊñáÊòéÁöÑÊäÄÊúØÁ°ÆÂÆûÊúâÊïàÔºå‰ΩÜ‰ªñ‰ª¨Ë¶ÅÊ±Ç‰∫∫Á±ªÂøÖÈ°ªÂÖàÈîÄÊØÅÊâÄÊúâÊ†∏Ê≠¶Âô®‰Ωú‰∏∫"ÂÖ•‰ºöË¥π"„ÄÇ', a: { text: 'ÊîæÊâã‰∏ÄÊêèÔºåÁî®Ââ©‰ΩôËÉΩÊ∫êÂÜçÊé®‰∏ÄÊ¨°ÔºåË¶Å‰πàÂÖ®Ëµ¢ÔºåË¶Å‰πàÂÖ®Ëæì„ÄÇ', tag: 'ËÉåÊ∞¥‰∏ÄÊàò¬∑ÊûÅÈôê', ending: 'Â•áËøπÂèëÁîü‰∫ÜÔºÅÂ∞èË°åÊòüÂú®ÊúÄÂêé‰∏ÄÂàªÂÅèÁ¶ª‰∫ÜÊíûÂáªËΩ®ÈÅì„ÄÇ‰∫∫Á±ªÁî®ÂãáÊ∞îÂíåÂõ¢ÁªìÊàòËÉú‰∫ÜÂëΩËøêÔºåËøô‰∏ÄÂ§©Ë¢´Ê∞∏ËøúÈì≠ËÆ∞‰∏∫"Êñ∞Â∏åÊúõÊó•"„ÄÇ' }, b: { text: 'Êé•ÂèóÈÉ®ÂàÜÊçüÂ§±ÔºåÂºÄÂßãÁÅæÂêéÈáçÂª∫ËÆ°ÂàíÔºå‰∫∫Á±ªÂ∞ÜÊµ¥ÁÅ´ÈáçÁîü„ÄÇ', tag: 'Âä°ÂÆûÈù¢ÂØπ¬∑ÈáçÁîü', ending: 'Â∞èË°åÊòüÊì¶ËøáÂú∞ÁêÉÔºåÈÄ†Êàê‰∫Ü‰∏•Èáç‰ΩÜÈùûÊØÅÁÅ≠ÊÄßÁöÑÁÅæÈöæ„ÄÇÂπ∏Â≠òÁöÑ‰∫∫Á±ªÂºÄÂßã‰∫ÜËâ∞ÈöæÁöÑÈáçÂª∫Ôºå‰ΩÜ‰ªñ‰ª¨Áü•ÈÅìÔºåÂè™Ë¶Å‰∫∫Á±ªËøòÂú®ÔºåÂ∏åÊúõÂ∞±Âú®„ÄÇ' } }
        ]
      },
      mystery: {
        name: 'ÊÇ¨ÁñëÊé®ÁêÜ', icon: 'üîç',
        opening: 'Êö¥È£éÈõ®‰πãÂ§úÔºåÂØåË±™ÈôàÂÆ∂ÁöÑÂÆ∂‰∏ªÈôàËÄÅÁà∑Âú®‰π¶ÊàøË¢´‰∫∫ÊØíÊùÄ„ÄÇÂ§ßÈó®‰ªéÂÜÖÂèçÈîÅÔºåÁ™óÊà∑ÂÆåÂ•ΩÊó†Êçü„ÄÇÂú®Âú∫ÁöÑÊúâÔºöÂ§ßÂÑøÂ≠êÈôàÊòé„ÄÅ‰∫åÂ•≥ÂÑøÈôàÊúà„ÄÅÁÆ°ÂÆ∂ËÄÅÂº†„ÄÅÂ•≥‰ªÜÂ∞èËä≥Ôºå‰ª•ÂèäÂàöÂà∞ËÆøÁöÑÁ•ûÁßòÂïÜ‰∫∫ÊùéÂÖàÁîü„ÄÇÊØè‰∏™‰∫∫‰ºº‰πéÈÉΩÊúâÂ´åÁñëÔºåÊØè‰∏™‰∫∫ÈÉΩÊúâÁßòÂØÜ...',
        rounds: [
          { context: 'Ë≠¶ÊñπÂ∞ÅÈîÅ‰∫ÜÂÆÖÈÇ∏ÔºåÊâÄÊúâ‰∫∫ÈÉΩ‰∏çËÉΩÁ¶ªÂºÄ„ÄÇ‰Ωú‰∏∫Ë¢´ÈÇÄËØ∑Êù•ÁöÑ‰æ¶Êé¢Ôºå‰Ω†ÂøÖÈ°ªÂºÄÂßãË∞ÉÊü•„ÄÇ', a: { text: 'È¶ñÂÖàÊêúÊü•Ê≠ªËÄÖÁöÑ‰π¶ÊàøÔºåÂØªÊâæÁâ©ËØÅÂíåÁ∫øÁ¥¢„ÄÇ', tag: 'Áâ©ËØÅ‰ºòÂÖà¬∑Á≥ªÁªü', consequence: 'Âú®‰π¶ÊàøÂèëÁé∞‰∫Ü‰∏ÄÂ∞ÅË¢´ÁÉßÊØÅ‰∏ÄÂçäÁöÑ‰ø°‰ª∂ÔºåÈöêÁ∫¶ÂèØËßÅ"ËÉåÂèõ"Âíå"ÈÅó‰∫ß"Â≠óÊ†∑...' }, b: { text: 'ÂàÜÂà´ËØ¢ÈóÆÂú®Âú∫ÊØè‰∏™‰∫∫ÔºåËßÇÂØü‰ªñ‰ª¨ÁöÑÂèçÂ∫îÂíåÊºèÊ¥û„ÄÇ', tag: ' locaisË®ÄËßÇËâ≤¬∑Áõ¥Ëßâ', consequence: 'ËØ¢ÈóÆ‰∏≠ÂèëÁé∞ÁÆ°ÂÆ∂ËÄÅÂº†Á•ûËâ≤ÊÖåÂº†ÔºåËÄåÈôàÊúàÊèêÂà∞Áà∂‰∫≤ÊúÄËøëÊî∂Âà∞ËøáÂ®ÅËÉÅ‰ø°...' } },
          { contextA: '‰ø°‰ª∂ÊòæÁ§∫ÈôàËÄÅÁà∑ÊõæÊâìÁÆóÊõ¥ÊîπÈÅóÂò±ÔºåÂâ•Â§∫Êüê‰∫∫ÁöÑÁªßÊâøÊùÉ„ÄÇ', contextB: 'Ëøõ‰∏ÄÊ≠•Ë∞ÉÊü•ÂèëÁé∞ÔºåÂ®ÅËÉÅ‰ø°Êù•Ëá™‰∏Ä‰∏™Á•ûÁßòÁªÑÁªáÔºåËÄåÊùéÂÖàÁîü‰ºº‰πé‰∏éËøô‰∏™ÁªÑÁªáÊúâÂÖ≥ËÅî„ÄÇ', a: { text: 'Ê∑±ÂÖ•Ë∞ÉÊü•ÈÅó‰∫ßÈóÆÈ¢òÔºåËøΩÊü•Ë∞ÅÊòØË¢´Ââ•Â§∫ÁªßÊâøÊùÉÁöÑ‰∫∫„ÄÇ', tag: 'ËøΩË∏™ÈáëÈí±¬∑Áé∞ÂÆû', consequenceFromA: 'ÂèëÁé∞ÈôàÊòéÊ¨†‰∏ãÂ∑®È¢ùËµåÂÄ∫ÔºåËÄåÈôàÊúà‰∏ÄÁõ¥Âú®ÁßòÂØÜËµÑÂä©‰∏Ä‰∏™ÊÖàÂñÑÊú∫ÊûÑ...', consequenceFromB: 'Ë∞ÉÊü•ÊòæÁ§∫ÈôàËÄÅÁà∑ÊúÄËøëËΩ¨Áßª‰∫ÜÂ§ßÁ¨îËµÑ‰∫ßÔºå‰ΩÜÂéªÂêë‰∏çÊòé...' }, b: { text: 'Ë∞ÉÊü•ÊùéÂÖàÁîüÁöÑË∫´‰ªΩÂíåÊù•ÂéÜÔºå‰ªñÁöÑÂá∫Áé∞Â§™ËøáÂ∑ßÂêà„ÄÇ', tag: 'ËøΩÊü•Â§ñ‰∫∫¬∑ÊÄÄÁñë', consequenceFromA: 'ÊùéÂÖàÁîüÁöÑË∫´‰ªΩË¢´Êè≠Èú≤Ôºö‰ªñÊòØÈôàËÄÅÁà∑Â§±Êï£Â§öÂπ¥ÁöÑÁßÅÁîüÂ≠ê...', consequenceFromB: 'ÊùéÂÖàÁîüÊâøËÆ§Ëá™Â∑±ÊòØÊù•Ë∞àÁîüÊÑèÁöÑÔºå‰ΩÜ‰ªñÂ∏¶Êù•‰∫Ü‰∏Ä‰∏™ÊÉä‰∫∫ÁöÑÁßòÂØÜ...' } },
          { contextAA: 'ÈôàÊòéÊúâÂä®Êú∫Ôºå‰ΩÜ‰ªñÊúâ‰∏çÂú®Âú∫ËØÅÊòé‚Äî‚ÄîÂ•≥‰ªÜÂ∞èËä≥ÂèØ‰ª•‰ΩúËØÅ„ÄÇ', contextAB: 'ËµÑ‰∫ßËΩ¨ÁßªÁöÑÁõÆÁöÑÂú∞ÊòØ‰∏Ä‰∏™Êµ∑Â§ñË¥¶Êà∑ÔºåÊà∑‰∏ªÂêçÂ≠óË¢´Âä†ÂØÜ„ÄÇ', contextBA: 'ÁßÅÁîüÂ≠êÁöÑÂá∫Áé∞ÊÑèÂë≥ÁùÄÈÅó‰∫ßÂ∞ÜË¢´ÈáçÊñ∞ÂàÜÈÖçÔºåÊâÄÊúâÂêàÊ≥ïÁªßÊâø‰∫∫ÈÉΩÊúâ‰∫ÜÂä®Êú∫„ÄÇ', contextBB: 'ÊùéÂÖàÁîüÈÄèÈú≤ÈôàËÄÅÁà∑ÁîüÂâç‰∏ÄÁõ¥Âú®Ë∞ÉÊü•‰∏ÄÊ°©ÈôàÂπ¥ÊóßÊ°à‚Äî‚Äî‰∏ÄËµ∑Ë¢´Êé©ÁõñÁöÑË∞ãÊùÄ„ÄÇ', a: { text: 'È™åËØÅÂ∞èËä≥ÁöÑËØÅËØçÔºåÂ•πÂèØËÉΩÊòØÂÖ≥ÈîÆËØÅ‰∫∫Ôºå‰πüÂèØËÉΩÊòØÂêåË∞ã„ÄÇ', tag: 'Ë¥®ÁñëËØÅËØç¬∑ÁªÜËá¥', consequence: 'ÂéãÂäõ‰πã‰∏ãÔºåÂ∞èËä≥Â¥©Ê∫É‰∫ÜÔºåÊâøËÆ§ÈôàÊòéÊõæÂ®ÅËÉÅÂ•π‰Ωú‰º™ËØÅ...' }, b: { text: 'Ë∞ÉÊü•ÈôàÂπ¥ÊóßÊ°àÔºåÊàñËÆ∏ËøáÂéªÁöÑÁßòÂØÜËÉΩÊè≠Á§∫Áé∞Âú®ÁöÑÁúüÁõ∏„ÄÇ', tag: 'ËøΩÊ∫ØËøáÂéª¬∑ËÄêÂøÉ', consequence: 'ÊóßÊ°àÁöÑÁ∫øÁ¥¢ÊåáÂêë20Âπ¥ÂâçÁöÑ‰∏ÄÂú∫ÁÅ´ÁÅæÔºåÈôàËÄÅÁà∑ÁöÑÂéüÈÖçÂ¶ªÂ≠êÂú®ÈÇ£Âú∫ÁÅ´ÁÅæ‰∏≠Ë∫´‰∫°...' } },
          { contextA: '‰º™ËØÅË¢´Êè≠Á©øÂêéÔºåÈôàÊòéÁöÑ‰∏çÂú®Âú∫ËØÅÊòéÂ§±Êïà„ÄÇ‰ΩÜ‰ªñÂùöÁß∞Ëá™Â∑±ÊòØÊó†ËæúÁöÑÔºåÂπ∂ÊåáÊéßÈôàÊúàÊâçÊòØÂá∂Êâã„ÄÇ', contextB: 'Ë∞ÉÊü•ÂèëÁé∞ÔºåÈÇ£Âú∫ÁÅ´ÁÅæÂπ∂ÈùûÊÑèÂ§ñÔºåËÄåÊòØ‰∫∫‰∏∫Á∫µÁÅ´„ÄÇÊõ¥ÊÉä‰∫∫ÁöÑÊòØÔºåÈôàËÄÅÁà∑ÂèØËÉΩÁü•ÈÅìÁúüÂá∂ÊòØË∞Å„ÄÇ', a: { text: 'ÂØπÈôàÊòéÂíåÈôàÊúàËøõË°å‰∫§ÂèâÂÆ°ÈóÆÔºåÊâæÂá∫Ë∞ÅÂú®ËØ¥Ë∞é„ÄÇ', tag: 'Ê≠£Èù¢ÂØπË¥®¬∑ÊøÄÁÉà', consequence: 'ÂÆ°ÈóÆ‰∏≠Ôºå‰∏Ä‰∏™ÊÉäÂ§©ÁßòÂØÜË¢´Êè≠ÂºÄÔºöÈôàÊúà‰∏çÊòØÈôàËÄÅÁà∑ÁöÑ‰∫≤ÁîüÂ•≥ÂÑø...' }, b: { text: 'ÈáçÊñ∞Ê£ÄÈ™åÊØíËçØÊù•Ê∫êÔºåÂá∂Âô®ÂæÄÂæÄËÉΩÊåáÂêëÁúüÂá∂„ÄÇ', tag: 'ÁßëÂ≠¶ÂàÜÊûê¬∑‰∏•Ë∞®', consequence: 'ÊØíËçØÊàêÂàÜÂàÜÊûêÊòæÁ§∫ÔºåËøôÁßçÊØíËçØÂè™ËÉΩ‰ªé‰∏ÄÁßçÁ®ÄÊúâÊ§çÁâ©‰∏≠ÊèêÂèñÔºåËÄåÁÆ°ÂÆ∂ËÄÅÂº†ÁöÑÊàøÈó¥ÈáåÁßçÁùÄËøôÁßçÊ§çÁâ©...' } },
          { contextA: 'ÈôàÊúàÁöÑË∫´‰∏ñÁßòÂØÜÊè≠ÂºÄÂêéÔºåÁúüÁõ∏ÈÄêÊ∏êÊµÆÂá∫Ê∞¥Èù¢ÔºöÂ•πÊòØ20Âπ¥ÂâçÁÅ´ÁÅæ‰∏≠"Ê≠ªÂéª"ÁöÑÈÇ£‰∏™‰∫∫ÁöÑÂ•≥ÂÑøÔºåË¢´ÈôàËÄÅÁà∑ÁßòÂØÜÊî∂ÂÖª„ÄÇ', contextB: 'ÊâÄÊúâËØÅÊçÆÈÉΩÊåáÂêëÁÆ°ÂÆ∂ËÄÅÂº†Ôºå‰ΩÜ‰ªñÂú®Ë¢´ÂÆ°ÈóÆÊó∂Á™ÅÁÑ∂ÂøÉËÑèÁóÖÂèë‰ΩúÔºåÁïô‰∏ã‰∏ÄÂè•ËØùÔºö"ÁúüÁõ∏...Âú®Ëä±Âõ≠ÁöÑËÄÅÊßêÊ†ë‰∏ã..."', a: { text: 'ÂÖ¨ÂºÄÊâÄÊúâÁúüÁõ∏ÔºåËÆ©Ê≥ïÂæãÊù•Ë£ÅÂÜ≥ÔºåÊó†ËÆ∫ÁªìÊûúÂ¶Ç‰Ωï„ÄÇ', tag: 'ÂÖ¨Ê≠£ÂÆ°Âà§¬∑Ê≥ïÊ≤ª', ending: 'ÁúüÁõ∏Â§ßÁôΩÔºöÁÆ°ÂÆ∂ËÄÅÂº†ÊòØ20Âπ¥ÂâçÈôàËÄÅÁà∑ÂéüÈÖçÁöÑÊÉÖ‰∫∫ÔºåÁÅ´ÁÅæÊòØ‰ªñ‰ª¨‰∏ÄËµ∑Á≠ñÂàíÁöÑ„ÄÇÈôàËÄÅÁà∑ÂèëÁé∞ÁúüÁõ∏ÂêéÊâìÁÆóÊè≠Âèë‰ªñÔºå‰∫éÊòØËÄÅÂº†Áóõ‰∏ãÊùÄÊâã„ÄÇÈôàÊúàÂæóÁü•Ëá™Â∑±ÁöÑË∫´‰∏ñÂêéÈÄâÊã©ÂéüË∞ÖÔºåÂπ∂Áî®ÁªßÊâøÁöÑÈÅó‰∫ßÊàêÁ´ã‰∫ÜÂü∫Èáë‰ºöÔºåÂ∏ÆÂä©ÈÇ£‰∫õÂÉèÂ•π‰∏ÄÊ†∑Â§±ÂéªÂÆ∂Â∫≠ÁöÑÂ≠©Â≠ê„ÄÇ' }, b: { text: 'Áªô‰∫àÁõ∏ÂÖ≥‰∫∫‰∏Ä‰∏™ÈÄâÊã©ÁöÑÊú∫‰ºöÔºåÊúâ‰∫õÁúüÁõ∏‰πüËÆ∏‰∏çËØ•Ë¢´ÂÖ¨ÂºÄ„ÄÇ', tag: '‰∫∫ÊÉÖËÄÉÈáè¬∑ÁÅ∞Ëâ≤', ending: '‰Ω†ÈÄâÊã©‰∫Ü‰∏Ä‰∏™Êäò‰∏≠ÁöÑÊñπÊ°àÔºöËÄÅÂº†ÁöÑÁΩ™Ë°åË¢´‰ΩéË∞ÉÂ§ÑÁêÜÔºåÂØπÂ§ñÂÆ£Â∏ÉÈôàËÄÅÁà∑Ê≠ª‰∫éÊÑèÂ§ñ„ÄÇÈôàÊòéÊàíÊéâ‰∫ÜËµåÂçöÔºåÈôàÊúàÁªßÁª≠Â•πÁöÑÊÖàÂñÑ‰∫ã‰∏öÔºåÊùéÂÖàÁîüÂ∏¶ÁùÄÁà∂‰∫≤ÁöÑÈÅóÁâ©Á¶ªÂºÄ„ÄÇÊúâ‰∫õÁúüÁõ∏Ë¢´Ê∞∏ËøúÂüãËë¨Ôºå‰ΩÜÊ¥ªÁùÄÁöÑ‰∫∫ÈÉΩÊúâ‰∫ÜÊñ∞ÁöÑÂºÄÂßã„ÄÇ' } }
        ]
      },
      political: {
        name: 'ÂÆ´Âª∑ÊùÉË∞ã', icon: 'üëë',
        opening: 'Â§ßÈΩêÁéãÊúùÔºåÊ∞∏ÂÆâ‰∏âÂçÅÂπ¥„ÄÇËÄÅÁöáÂ∏ùÈ©æÂ¥©ÁöÑÊ∂àÊÅØÈúáÊÉäÊúùÈáé„ÄÇÈÅóËØè‰∏≠Âç¥Âá∫Áé∞‰∫Ü‰ª§‰∫∫Ë¥πËß£ÁöÑÂÜÖÂÆπÔºöÁöá‰Ωç‰∏ç‰º†Áªô‰∏â‰ΩçÊàêÂπ¥ÁöáÂ≠ê‰∏≠ÁöÑ‰ªª‰Ωï‰∏Ä‰∏™ÔºåËÄåÊòØÁî±"ÊúÄËÉΩ‰ª£Ë°®Ê∞ëÂøÉËÄÖ"ÁªßÊâø„ÄÇ‰∏ÄÊó∂Èó¥ÔºåÊúùÂ†ÇÊöóÊµÅÊ∂åÂä®ÔºåÂêÑÊñπÂäøÂäõË†¢Ë†¢Ê¨≤Âä®...',
        rounds: [
          { context: '‰Ωú‰∏∫ÂÖàÂ∏ù‰ø°‰ªªÁöÑÂÜÖÈòÅÈ¶ñËæÖÔºå‰Ω†ÂøÖÈ°ªÂú®Ê∑∑‰π±‰∏≠Áª¥ÊåÅÂ±ÄÈù¢„ÄÇ‰∏â‰ΩçÁöáÂ≠êÂêÑÊúâÊîØÊåÅËÄÖÔºöÂ§™Â≠ê‰ªÅÂéö‰ΩÜÊá¶Âº±Ôºå‰∫åÁöáÂ≠êÁ≤æÊòé‰ΩÜÊÆãÂøçÔºå‰∏âÁöáÂ≠êÂπ¥ËΩª‰ΩÜÈîêÊÑèÊîπÈù©„ÄÇ', a: { text: 'ÊîØÊåÅÂ§™Â≠êÊåâ‰º†ÁªüÁªß‰ΩçÔºåÁª¥Êä§Â´°ÈïøÂ≠êÁªßÊâøÂà∂Â∫¶ÁöÑÁ®≥ÂÆö„ÄÇ', tag: '‰º†ÁªüÊ≠£Áªü¬∑‰øùÂÆà', consequence: 'Â§™Â≠êËé∑Âæó‰Ω†ÁöÑÊîØÊåÅÂêé‰ø°ÂøÉÂ§ßÂ¢ûÔºå‰ΩÜ‰∫åÁöáÂ≠êÁöÑÊîØÊåÅËÄÖÂºÄÂßãÊöó‰∏≠ËÅîÁªúÂÜõÊñπ...' }, b: { text: 'ÊèêËÆÆ‰∏â‰ΩçÁöáÂ≠êÂêÑÈôàÊñΩÊîøÁ∫≤È¢ÜÔºåÁî±ÁôæÂÆòÂÖ¨ËÆÆÂÜ≥ÂÆö‰∫∫ÈÄâ„ÄÇ', tag: 'ÂÖ¨ËÆÆÂÜ≥ÈÄâ¬∑Èù©Êñ∞', consequence: 'Ëøô‰∏™ÊèêËÆÆÂºïÂèëËΩ©ÁÑ∂Â§ßÊ≥¢ÔºåÊîπÈù©Ê¥æÊ¨¢ÂëºÔºå‰øùÂÆàÊ¥æÂº∫ÁÉàÂèçÂØπ...' } },
          { contextA: '‰∫åÁöáÂ≠êÂãæÁªìËæπÁñÜÂ∞ÜÂÜõÔºåÂØÜË∞ãËµ∑ÂÖµ"Ê∏ÖÂêõ‰æß"ÔºåÂ±ÄÂäøÈ™§ÁÑ∂Á¥ßÂº†„ÄÇ', contextB: 'ÂÖ¨ËÆÆ‰πãÂâçÔºåÊúâ‰∫∫Êè≠Âèë‰∏âÁöáÂ≠ê‰∏éÂ§ñÈÇ¶‰ΩøËäÇÊúâÁßòÂØÜÂæÄÊù•ÔºåÊ∂âÂ´åÂèõÂõΩ„ÄÇ', a: { text: 'Á¥ßÊÄ•Ë∞ÉÂä®Âæ°ÊûóÂÜõÂ∏ÉÈò≤ÔºåÂêåÊó∂Ê¥æÂØÜ‰ΩøÂàÜÂåñ‰∫åÁöáÂ≠êÁöÑÂêåÁõü„ÄÇ', tag: 'ÂàÜÂåñÁì¶Ëß£¬∑ÊùÉË∞ã', consequenceFromA: '‰Ω†ÁöÑËÆ°Á≠ñÊàêÂäüÊãñÂª∂‰∫Ü‰∫åÁöáÂ≠êÁöÑË°åÂä®Ôºå‰ΩÜ‰ªñÂºÄÂßãÊÄÄÁñëÂÜÖÈÉ®Êúâ‰∫∫ËÉåÂèõ...', consequenceFromB: '‰Ω†Âà©Áî®Ëøô‰∏™Êú∫‰ºöÊâìÂéã‰∏âÁöáÂ≠êÔºå‰ΩÜË∞ÉÊü•ÊòæÁ§∫Êè≠Âèë‰ø°ÂèØËÉΩÊòØ‰º™ÈÄ†ÁöÑ...' }, b: { text: '‰∏ªÂä®Êâæ‰∫åÁöáÂ≠êË∞àÂà§Ôºå‰∫ÜËß£‰ªñÁöÑËØâÊ±ÇÔºåÂØªÊâæÂíåÂπ≥Ëß£ÂÜ≥ÁöÑÂèØËÉΩ„ÄÇ', tag: 'ÂíåË∞àÊ≠¢ÂÖµ¬∑ÂÜíÈô©', consequenceFromA: '‰∫åÁöáÂ≠êÊèêÂá∫Êù°‰ª∂Ôºö‰ªñË¶ÅÂ§™Â≠êÁöÑ‰ΩçÁΩÆÔºå‰ΩÜÊâøËØ∫ÂñÑÂæÖÂÖÑÂºü...', consequenceFromB: 'Êè≠Âèë‰∫ã‰ª∂‰Ωø‰∏âÁöáÂ≠êÈô∑ÂÖ•Âõ∞Â¢ÉÔºå‰Ω†ÂÜ≥ÂÆö‰∫≤Ëá™Ë∞ÉÊü•ÁúüÁõ∏...' } },
          { contextAA: '‰∫åÁöáÂ≠êÁöÑÁõüÂèãË¢´ÊàêÂäüÁ≠ñÂèçÔºå‰ΩÜÂØπÊñπË¶ÅÊ±Ç‰∫ãÊàê‰πãÂêéÂ∞Å‰æØÊãúÁõ∏„ÄÇ', contextAB: 'Ë∞ÉÊü•ÊòæÁ§∫Êè≠Âèë‰ø°Âá∫Ëá™Â§™ÂêéÁöÑ‰∫≤‰ø°ÔºåÁõÆÁöÑÊòØÊâ∂ÊåÅÂ•πÁöÑÂ§ñÁî•‰∏ä‰Ωç„ÄÇ', contextBA: '‰∫åÁöáÂ≠êÁöÑÊù°‰ª∂‰ª§‰∫∫Èöæ‰ª•Êé•ÂèóÔºå‰ΩÜ‰ªñÊâãÊè°ÈáçÂÖµÔºåÊãíÁªùÂèØËÉΩÂØºËá¥ÂÜÖÊàò„ÄÇ', contextBB: 'Â§™ÂêéÂºÄÂßãÂÖ¨ÂºÄÂπ≤ÊîøÔºå‰ª•ÂÖàÂ∏ùÈÅóÂ≠ÄÁöÑË∫´‰ªΩË¶ÅÊ±Ç"ÂûÇÂ∏òÂê¨Êîø"„ÄÇ', a: { text: 'Á≠îÂ∫îÂ∞Å‰æØÁöÑÊù°‰ª∂Ôºå‰∏§ÂÆ≥Áõ∏ÊùÉÂèñÂÖ∂ËΩªÔºåÂÖàÁ®≥‰ΩèÂ±ÄÈù¢„ÄÇ', tag: 'ÊùÉÂÆú‰πãËÆ°¬∑Â¶•Âçè', consequence: 'Â±ÄÂäøÊöÇÊó∂Á®≥ÂÆöÔºå‰ΩÜ‰Ω†Áü•ÈÅìËøôÂè™ÊòØÂºÄÂßãÔºåÊõ¥Â§ßÁöÑÈ£éÊö¥ËøòÂú®ÂêéÈù¢...' }, b: { text: 'Êè≠Èú≤Â§™ÂêéÁöÑÈò¥Ë∞ãÔºåËÅîÂêà‰∏â‰ΩçÁöáÂ≠êÂÖ±ÂêåÂØπÊäóÂ§ñÊàö‰∏ìÊùÉ„ÄÇ', tag: 'Âõ¢ÁªìÊäóÊïå¬∑Ê≠£‰πâ', consequence: '‰Ω†ÁöÑÊè≠Èú≤ËÆ©ÊúùÂ†ÇÈúáÂä®Ôºå‰∏â‰ΩçÁöáÂ≠êÁ†¥Â§©ËçíÂú∞Á´ôÂú®‰∫Ü‰∏ÄËµ∑...' } },
          { contextA: 'ÂêÑÊñπÂäøÂäõÊöÇÊó∂Âπ≥Ë°°Ôºå‰ΩÜÂÇ®‰Ωç‰πã‰∫â‰ªçÊÇ¨ËÄåÊú™ÂÜ≥„ÄÇËøôÊó∂ËæπÁñÜ‰º†Êù•ÊÄ•Êä•ÔºöÂåóÊñπÊ∏∏ÁâßÊ∞ëÊóèÂ§ßÂÜõÂéãÂ¢É„ÄÇ', contextB: 'Â§™ÂêéË¢´ËΩØÁ¶ÅÔºåÂ§ñÊàöÂäøÂäõÁì¶Ëß£„ÄÇ‰ΩÜÂú®Êï¥ÁêÜÂ§™ÂêéÂØùÂÆ´Êó∂ÔºåÂèëÁé∞‰∫ÜÂÖàÂ∏ùÁöÑÂè¶‰∏Ä‰ªΩÈÅóËØè...', a: { text: 'Âª∫ËÆÆ‰∏â‰ΩçÁöáÂ≠ê‰∫≤ÂæÅÂåóÁñÜÔºåË∞ÅËÉΩÂáªÈÄÄÊïåÂÜõË∞ÅÂ∞±ÊòØÊñ∞Â∏ù„ÄÇ', tag: '‰ª•ÊàòÂÆöÂ∏ù¬∑È≠ÑÂäõ', consequence: '‰∏â‰ΩçÁöáÂ≠êÁéáÂÜõÂåó‰∏äÔºåËøôÂú∫Êàò‰∫âÂ∞ÜÂÜ≥ÂÆöÂ§ßÈΩêÁöÑÊú™Êù•...' }, b: { text: 'ÊèêËÆÆÂÖàÈÄâÂá∫Êñ∞Â∏ùÂÜçÂ∫îÂØπÂ§ñÊïåÔºåÂõΩ‰∏çÂèØ‰∏ÄÊó•Êó†Âêõ„ÄÇ', tag: 'ÂÖàÂÜÖÂêéÂ§ñ¬∑Á®≥Èáç', consequence: 'Âú®‰Ω†ÁöÑ‰∏ªÊåÅ‰∏ãÔºå‰∏ÄÂú∫ÂÜ≥ÂÆöÊÄßÁöÑÊúùËÆÆÂç≥Â∞ÜÂºÄÂßã...' } },
          { contextA: 'ÂåóÁñÜÊàò‰∫ãËÉ∂ÁùÄÔºåÂ§™Â≠ê‰ªÅÂæ∑ÊäöÊ∞ëÔºå‰∫åÁöáÂ≠êÂãáÁåõ‰ΩúÊàòÔºå‰∏âÁöáÂ≠êÂêéÂã§Ë∞ÉÂ∫¶ÊúâÊñπ„ÄÇ‰∏â‰∫∫ÂêÑÊúâÂäüÂä≥ÔºåÈöæÂàÜÈ´ò‰∏ã„ÄÇ', contextB: 'ÂÖàÂ∏ùÁöÑÁúüÊ≠£ÈÅóËØèË¢´ÊâæÂà∞Ôºå‰∏äÈù¢ÂÜôÁùÄÔºöÁöá‰Ωç‰º†Áªô"ËÉΩËÆ©‰∏â‰∏™ÂÑøÂ≠êÂíåÁù¶ÂÖ±Â§ÑËÄÖ"„ÄÇËøô‰∏™‰∫∫...Á´üÁÑ∂ÊòØ‰Ω†„ÄÇ', a: { text: 'Âª∫ËÆÆ‰∏â‰ΩçÁöáÂ≠êÂÖ±ÂêåÊâßÊîøÔºåÂª∫Á´ã"‰∏âÁéãËÆÆÊîø"ÁöÑÊñ∞Âà∂Â∫¶„ÄÇ', tag: 'ÊùÉÂäõÂÖ±‰∫´¬∑ÂºÄÂàõ', ending: 'Â§ßÈΩêÁéãÊúùËøõÂÖ•‰∫ÜÂâçÊâÄÊú™ÊúâÁöÑ"‰∏âÁéãÊó∂‰ª£"„ÄÇÂ§™Â≠ê‰∏ªÂÜÖÊîøÔºå‰∫åÁöáÂ≠êÊéåÂÜõ‰∫ãÔºå‰∏âÁöáÂ≠êË¥üË¥£ÊîπÈù©„ÄÇËôΩÁÑ∂‰∫âÂêµ‰∏çÊñ≠Ôºå‰ΩÜÂú®‰Ω†ÁöÑË∞ÉÂíå‰∏ãÔºåËøô‰∏™Âà∂Â∫¶Á´üÁÑ∂ËøêËΩ¨‰∫ÜËµ∑Êù•„ÄÇ‰∫åÂçÅÂπ¥ÂêéÔºå‰Ω†Âú®ÂõûÂøÜÂΩï‰∏≠ÂÜôÈÅìÔºö"ÊúÄÂ•ΩÁöÑÂà∂Â∫¶‰∏çÊòØÂÆåÁæéÁöÑÂà∂Â∫¶ÔºåËÄåÊòØËÉΩËá™ÊàëÁ∫†ÈîôÁöÑÂà∂Â∫¶„ÄÇ"' }, b: { text: 'ÊåâÂÜõÂäüÂ§ßÂ∞èÊéíÂ∫èÔºåÁî±ÂäüÂä≥ÊúÄÂ§ßËÄÖÁªßÊâøÁöá‰Ωç„ÄÇ', tag: 'ÂäüÂããÂÆö‰Ωç¬∑ÂÖ¨Âπ≥', ending: '‰∫åÁöáÂ≠êÂá≠ÂÄüÊàòÂäüÁôªÂü∫Ôºå‰ΩÜ‰ªñÊ≤°ÊúâËæúË¥ü‰ø°‰ªª„ÄÇÂú®‰ΩçÊúüÈó¥ÂåóÂáªÊ∏∏Áâß„ÄÅÂÜÖ‰øÆÊîøÊ≤ªÔºåÂ§ßÈΩêËøéÊù•‰∫Ü‰∏≠ÂÖ¥„ÄÇ‰∏âÁöáÂ≠êË¢´Â∞Å‰∏∫ÊîπÈù©Áâπ‰ΩøÔºåÂ§™Â≠ê‰∏ªÁÆ°Á§ºÈÉ®ÊïôÂåñ„ÄÇ‰Ω†‰ª•‰∏ÉÂçÅÈ´òÈæÑËæûÂÆòÂΩíÈöêÊó∂ÔºåÊñ∞Â∏ù‰∫≤Ëá™ÈÄÅË°åÂçÅÈáåÔºåËØ¥Ôºö"Ê≤°ÊúâÈ¶ñËæÖÂ§ß‰∫∫ÔºåÂ∞±Ê≤°Êúâ‰ªäÊó•ÁöÑÂ§ßÈΩê„ÄÇ"' } }
        ]
      }
    };

    const AI_PLAYERS = [
      { id: 'ai_1', name: 'Êô∫ËÄÖ¬∑Ëâæ‰∏ù', avatar: 'üßô‚Äç‚ôÄÔ∏è', exp: 1200, isAI: true, style: 'analytical' },
      { id: 'ai_2', name: 'ÂãáËÄÖ¬∑ÂáØÊÅ©', avatar: '‚öîÔ∏è', exp: 1100, isAI: true, style: 'bold' },
      { id: 'ai_3', name: 'Â≠¶ËÄÖ¬∑ËØ∫‰∫ö', avatar: 'üìö', exp: 1300, isAI: true, style: 'cautious' },
      { id: 'ai_4', name: 'ÂïÜ‰∫∫¬∑È©¨ÂèØ', avatar: 'üí∞', exp: 1150, isAI: true, style: 'pragmatic' },
      { id: 'ai_5', name: 'ËØó‰∫∫¬∑ÊúàÂçé', avatar: 'üé≠', exp: 1050, isAI: true, style: 'romantic' },
    ];

    const generateAIDebate = (style) => {
      const debates = {
        analytical: { A: ['‰ªéÈÄªËæë‰∏äÂàÜÊûêÔºåÈÄâÈ°πAÁöÑÊàêÂäüÁéáÊõ¥È´ò', 'Êï∞ÊçÆË°®ÊòéÔºåÊûúÊñ≠Ë°åÂä®ÂæÄÂæÄÊïàÊûúÊõ¥Â•Ω'], B: ['‰ªîÁªÜÂàÜÊûêÂêéÔºåBÁöÑÈïøÊúüÊî∂ÁõäÊõ¥Â§ß', 'ÁªºÂêàËÄÉÈáèÔºåBÊòØÊõ¥Á®≥Â¶•ÁöÑÊñπÊ°à'] },
        bold: { A: ['ÂãáËÄÖ‰∏çÊÉßÔºÅAÊâçÊòØÁúüÊ≠£ÁöÑËã±ÈõÑ‰πãÈÄâ', 'ÊûúÊñ≠Âá∫ÂáªÔºÅÊîØÊåÅAÔºÅ'], B: ['BÊâçÊòØÁúüÊ≠£ÁöÑÂãáÊ∞îÔºÅÊï¢‰∫é‰∏çÂêåÔºÅ', 'Êô∫ÂãáÂèåÂÖ®ÊâçÊòØÁúüËã±ÈõÑÔºåÈÄâBÔºÅ'] },
        cautious: { A: ['ËôΩÁÑ∂ÂÜíÈô©Ôºå‰ΩÜAÊàñËÆ∏ÊòØÂøÖË¶ÅÁöÑ', '‰∏§ÂÆ≥Áõ∏ÊùÉÂèñÂÖ∂ËΩªÔºåÊîØÊåÅA'], B: ['Ë∞®ÊÖéËµ∑ËßÅÔºåBÊõ¥ÂÆâÂÖ®', 'ÁïôÂæóÈùíÂ±±Âú®ÔºåÈÄâBÊõ¥ÊòéÊô∫'] },
        pragmatic: { A: ['‰ªéÂà©ÁõäËßíÂ∫¶ÔºåAÂõûÊä•Êõ¥È´ò', 'ÂïÜ‰∫∫ÁöÑÁõ¥ËßâÂëäËØâÊàëÔºåÈÄâA'], B: ['BÁöÑÈ£éÈô©Êõ¥ÂèØÊéß', 'ÈïøËøúÊù•ÁúãÔºåBÊî∂ÁõäÊõ¥Á®≥ÂÆö'] },
        romantic: { A: ['AÊúâÁßçÊÇ≤Â£ÆÁöÑÁæéÊÑü', 'ÂëΩËøêÁöÑËØóÁØáÈúÄË¶ÅAËøôÊ†∑ÁöÑËΩ¨Êäò'], B: ['B‰ª£Ë°®ÁùÄÂ∏åÊúõ‰∏éÂèØËÉΩ', 'BÊâçÊòØÊúÄÂä®‰∫∫ÁöÑÁ≠îÊ°à'] },
      };
      const choice = Math.random() > 0.5 ? 'A' : 'B';
      const options = debates[style]?.[choice] || debates.analytical[choice];
      return { text: options[Math.floor(Math.random() * options.length)], choice };
    };

    function App() {
      const [db, setDb] = useState(null);
      const [walletAddress, setWalletAddress] = useState(null);
      const [walletConnecting, setWalletConnecting] = useState(false);
      const [view, setView] = useState('home');
      const [player, setPlayer] = useState({ id: '', name: '', avatar: 'üéÆ', exp: 1000 });
      const [roomId, setRoomId] = useState(null);
      const [roomData, setRoomData] = useState(null);
      const [players, setPlayers] = useState([]);
      const [gameState, setGameState] = useState(null);
      const [messages, setMessages] = useState([]);
      const [availableRooms, setAvailableRooms] = useState([]);
      const [debateInput, setDebateInput] = useState('');
      const [myVote, setMyVote] = useState(null);
      const [timer, setTimer] = useState(0);
      const [leaderboard, setLeaderboard] = useState([]);
      const timerRef = useRef(null);
      const messagesEndRef = useRef(null);
      const roomCheckRef = useRef(null);

      useEffect(() => {
        try {
          if (!firebase.apps.length) {
            firebase.initializeApp(CONFIG.FIREBASE);
          }
          const database = firebase.database();
          setDb(database);
        } catch (err) { 
          console.error('Firebase init error:', err); 
        }
        try {
          const saved = localStorage.getItem('consensus_leaderboard');
          if (saved) setLeaderboard(JSON.parse(saved));
        } catch {}
        return () => {
          if (timerRef.current) clearInterval(timerRef.current);
          if (roomCheckRef.current) clearInterval(roomCheckRef.current);
        };
      }, []);

      useEffect(() => {
        if (!db) return;
        const roomsRef = db.ref('rooms');
        roomsRef.on('value', (snapshot) => {
          const data = snapshot.val();
          const now = Date.now();
          if (data) {
            const rooms = [];
            Object.entries(data).forEach(([id, room]) => {
              const age = now - room.createdAt;
              if (room.status === 'waiting' && age > CONFIG.ROOM_TIMEOUT_CLOSE) {
                db.ref(`rooms/${id}`).update({ status: 'closed' });
                return;
              }
              if (room.status === 'waiting') {
                rooms.push({ id, ...room, age });
              }
            });
            setAvailableRooms(rooms);
          } else {
            setAvailableRooms([]);
          }
        });
      }, [db]);

      useEffect(() => {
        if (!db || !roomId) return;
        const roomRef = db.ref(`rooms/${roomId}`);
        const gameRef = db.ref(`games/${roomId}`);
       
        roomRef.on('value', (s) => {
          const d = s.val();
          if (d) {
            setRoomData(d);
            if (d.players) setPlayers(Object.values(d.players));
            if (d.status === 'closed') {
              alert('ÊàøÈó¥Â∑≤ÂÖ≥Èó≠');
              resetGame();
            }
          }
        });
       
        gameRef.on('value', (s) => {
          const d = s.val();
          if (d) {
            setGameState(d);
            if (d.messages) setMessages(Object.values(d.messages).sort((a, b) => a.timestamp - b.timestamp));
            if (d.timerEnd && d.phase !== 'ended') setTimer(Math.max(0, Math.floor((d.timerEnd - Date.now()) / 1000)));
          }
        });
        return () => {
          roomRef.off();
          gameRef.off();
        };
      }, [db, roomId]);

      useEffect(() => {
        if (!db || !roomId || !roomData || roomData.status !== 'waiting') return;
        if (roomCheckRef.current) clearInterval(roomCheckRef.current);
       
        roomCheckRef.current = setInterval(() => {
          const age = Date.now() - roomData.createdAt;
          const playerCount = Object.keys(roomData.players || {}).filter(id => !id.startsWith('ai_')).length;
         
          if (age > CONFIG.ROOM_TIMEOUT_AI && playerCount === 1 && player.id === roomData.host) {
            const currentPlayerIds = Object.keys(roomData.players || {});
            const availableAI = AI_PLAYERS.filter(ai => !currentPlayerIds.includes(ai.id));
            const aiToAdd = availableAI.slice(0, CONFIG.ROOM_SIZE.min - 1);
           
            aiToAdd.forEach((ai, i) => {
              setTimeout(() => {
                db.ref(`rooms/${roomId}/players/${ai.id}`).set(ai);
                addMessage('system', `${ai.avatar} ${ai.name} Âä†ÂÖ•‰∫ÜÊàøÈó¥`);
              }, i * 1000);
            });
          }
        }, 5000);
        return () => { if (roomCheckRef.current) clearInterval(roomCheckRef.current); };
      }, [db, roomId, roomData, player.id]);

      useEffect(() => {
        if (!gameState?.timerEnd || gameState?.phase === 'ended') return;
        if (timerRef.current) clearInterval(timerRef.current);
        timerRef.current = setInterval(() => {
          const remaining = Math.max(0, Math.floor((gameState.timerEnd - Date.now()) / 1000));
          setTimer(remaining);
          if (remaining <= 0 && player.id === roomData?.host) handlePhaseEnd();
        }, 1000);
        return () => { if (timerRef.current) clearInterval(timerRef.current); };
      }, [gameState?.timerEnd, gameState?.phase]);

      useEffect(() => { messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' }); }, [messages]);

      const connectWallet = async () => {
        if (!window.ethereum) { alert('ËØ∑ÂÆâË£ÖMetaMaskÈí±ÂåÖ'); return null; }
        setWalletConnecting(true);
        try {
          const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          setWalletAddress(accounts[0]);
          setPlayer(p => ({ ...p, id: accounts[0] }));
          return accounts[0];
        } catch (err) { alert('Èí±ÂåÖËøûÊé•Â§±Ë¥•: ' + err.message); return null; }
        finally { setWalletConnecting(false); }
      };

      const payEntryFee = async () => {
        console.log('„ÄêÊµãËØïÊ®°Âºè„ÄëË∑≥ËøáÊâ£Ë¥π');
        return true;
      };

      const recordGameToGenLayer = async (gameData) => {
        console.log('„ÄêÊµãËØïÊ®°Âºè„ÄëË∑≥ËøáËÆ∞ÂΩïÂà∞GenLayer', gameData);
      };

      const addMessage = async (type, text, sender = null, choice = null) => {
        if (!db || !roomId) return;
        await db.ref(`games/${roomId}/messages`).push().set({ type, text, sender, choice, timestamp: Date.now() });
      };

      const createRoom = async (theme) => {
        if (!db || !player.name) return;
       
        let address = walletAddress;
        if (!address) {
          address = await connectWallet();
          if (!address) return;
        }
       
        const paid = await payEntryFee();
        if (!paid) return;
       
        const newRoomId = `room_${Date.now()}`;
        await db.ref(`rooms/${newRoomId}`).set({
          theme,
          host: address,
          status: 'waiting',
          createdAt: Date.now(),
          players: { 
            [address]: { 
              id: address, 
              name: player.name, 
              avatar: player.avatar, 
              exp: player.exp, 
              isAI: false 
            } 
          }
        });
        setRoomId(newRoomId);
        setView('room');
        addMessage('system', `ÊàøÈó¥Â∑≤ÂàõÂª∫ÔºåÁ≠âÂæÖÂÖ∂‰ªñÁé©ÂÆ∂Âä†ÂÖ•...`);
      };

      const joinRoom = async (targetRoomId) => {
        if (!db || !player.name) return;
       
        let address = walletAddress;
        if (!address) {
          address = await connectWallet();
          if (!address) return;
        }
       
        const paid = await payEntryFee();
        if (!paid) return;
       
        await db.ref(`rooms/${targetRoomId}/players/${address}`).set({
          id: address,
          name: player.name,
          avatar: player.avatar,
          exp: player.exp,
          isAI: false
        });
        setRoomId(targetRoomId);
        setView('room');
      };

      const addAIPlayers = async () => {
        if (!db || !roomId) return;
        const currentPlayerIds = Object.keys(roomData?.players || {});
        const availableAI = AI_PLAYERS.filter(ai => !currentPlayerIds.includes(ai.id));
        const shuffled = availableAI.sort(() => Math.random() - 0.5);
        const aiToAdd = shuffled.slice(0, Math.min(3, CONFIG.ROOM_SIZE.max - currentPlayerIds.length));
       
        for (let i = 0; i < aiToAdd.length; i++) {
          await new Promise(r => setTimeout(r, 1000));
          await db.ref(`rooms/${roomId}/players/${aiToAdd[i].id}`).set(aiToAdd[i]);
          addMessage('system', `${aiToAdd[i].avatar} ${aiToAdd[i].name} Âä†ÂÖ•‰∫ÜÊàøÈó¥`);
        }
      };

      const startGame = async () => {
        if (!db || !roomId || players.length < CONFIG.ROOM_SIZE.min) return;
       
        await db.ref(`rooms/${roomId}`).update({ status: 'playing' });
       
        const theme = roomData?.theme || 'fantasy';
        const arc = STORY_ARCS[theme];
        const initScores = {};
        players.forEach(p => { initScores[p.id] = { influence: 0, debates: 0, wins: 0 }; });
       
        await db.ref(`games/${roomId}`).set({
          round: 1,
          phase: 'debate',
          path: [],
          scores: initScores,
          votes: {},
          story: [{ text: arc.opening, type: 'opening', round: 0 }],
          timerEnd: Date.now() + CONFIG.DEBATE_DURATION * 1000,
          messages: {}
        });
       
        setView('game');
        addMessage('system', `üìñ ${arc.name}ÂºÄÂßã‰∫ÜÔºÅÁ¨¨ 1/${CONFIG.TOTAL_ROUNDS} ËΩÆ - Ëæ©ËÆ∫Èò∂ÊÆµ`);
        setTimeout(() => simulateAIDebate(), 3000);
      };

      const simulateAIDebate = () => {
        players.filter(p => p.isAI).forEach((ai, i) => {
          setTimeout(() => {
            const debate = generateAIDebate(ai.style);
            addMessage('chat', debate.text, ai, debate.choice);
          }, (i + 1) * 3000 + Math.random() * 5000);
        });
      };

      const handlePhaseEnd = async () => {
        if (!db || !roomId || !gameState) return;
        if (gameState.phase === 'debate') {
          await db.ref(`games/${roomId}`).update({ 
            phase: 'vote', 
            timerEnd: Date.now() + CONFIG.VOTE_DURATION * 1000, 
            votes: {} 
          });
          addMessage('system', 'üó≥Ô∏è ÊäïÁ•®Èò∂ÊÆµÂºÄÂßãÔºÅ');
          setMyVote(null);
          players.filter(p => p.isAI).forEach((ai, i) => {
            setTimeout(async () => {
              await db.ref(`games/${roomId}/votes/${ai.id}`).set(Math.random() > 0.5 ? 'A' : 'B');
            }, (i + 1) * 2000);
          });
        } else if (gameState.phase === 'vote') {
          await calculateResult();
        }
      };

      const calculateResult = async () => {
        if (!db || !roomId || !gameState) return;
        const votes = gameState.votes || {};
        const voteCount = { A: 0, B: 0 };
        Object.values(votes).forEach(v => { if (v) voteCount[v]++; });
        const winner = voteCount.A >= voteCount.B ? 'A' : 'B';
       
        const newScores = { ...gameState.scores };
        Object.entries(votes).forEach(([id, v]) => {
          if (v === winner && newScores[id]) {
            newScores[id].influence = (newScores[id].influence || 0) + 30;
            newScores[id].wins = (newScores[id].wins || 0) + 1;
          }
        });
       
        const newPath = [...(gameState.path || []), winner];
        const round = gameState.round;
        const consequence = getConsequence(round, winner, gameState.path || []);
        const winOpt = getOption(round, winner);
        const newStory = [...(gameState.story || []),
          { text: `„Äê‰ºó‰∫∫ÈÄâÊã©„Äë${winOpt?.text}`, type: 'choice', round, winner },
          { text: consequence, type: 'consequence', round }
        ];
       
        addMessage('system', `üìú ÈÄâÈ°π ${winner} Ëé∑ËÉúÔºÅ(${voteCount[winner]}Á•® vs ${voteCount[winner === 'A' ? 'B' : 'A']}Á•®)`);
       
        if (round >= CONFIG.TOTAL_ROUNDS) {
          await db.ref(`games/${roomId}`).update({ 
            phase: 'ended', 
            scores: newScores, 
            path: newPath, 
            story: newStory, 
            timerEnd: null 
          });
          addMessage('system', 'üèÜ ÁºñÂπ¥Âè≤ÂÆåÊàêÔºÅ');
         
          const topPlayer = Object.entries(newScores).sort((a, b) => (b[1].influence + b[1].debates) - (a[1].influence + a[1].debates))[0];
          await recordGameTo